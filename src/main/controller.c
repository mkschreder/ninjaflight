
enum {
	WEIGHT_STAB_ROLL_RATE = 0,
	WEIGHT_STAB_PITCH_RATE,
	WEIGHT_STAB_YAW_RATE,
	WEIGHT_STAB_BODY_ROLL,
	WEIGHT_STAB_BODY_PITCH,
	WEIGHT_STAB_BODY_HEADING,
	WEIGHT_STAB_POSITION_N,
	WEIGHT_STAB_POSITION_E,
	WEIGHT_STAB_POSITION_D,
	WEIGHT_STAB_VELOCITY_X,
	WEIGHT_STAB_VELOCITY_Y,
	WEIGHT_STAB_VELOCITY_Z,
	CONTROL_ROLL_RATE,
	CONTROL_PITCH_RATE,
	CONTROL_YAW_RATE,
	CONTROL_ROLL_ANGLE,
	CONTROL_PITCH_ANGLE,
	CONTROL_YAW_ANGLE,
	CONTROL_BODY_VELOCITY_X,
	CONTROL_BODY_VELOCITY_Y,
	CONTROL_BODY_VELOCITY_Z,
	CONTROL_THRUST_ROLL_ANGLE,
	CONTROL_THRUST_PITCH_ANGLE
} controller_dst_channel_t;

typedef enum {
	INPUT_COMMAND_ROLL,
	INPUT_COMMAND_PITCH,
	INPUT_COMMAND_YAW,
	INPUT_COMMAND_THROTTLE,
	INPUT_RULE_IMIN,
} controller_src_channel_t;

struct controller_rule_def {
	controller_src_channel_t src;
	controller_dst_channel_t dst;
	int16_t imin;
	int16_t imax;
	int16_t omin;
	int16_t omax;
};

const struct controller_rule_def rateControl[] = {
	{ INPUT_COMMAND_ROLL, CONTROL_ROLL_RATE,	-500, 500, -500, 500 },
	{ INPUT_COMMAND_PITCH, CONTROL_PITCH_RATE,	-500, 500, -500, 500 },
	{ INPUT_COMMAND_YAW, CONTROL_YAW_RATE,		-500, 500, -500, 500 },
	{ INPUT_COMMAND_THROTTLE, CONTROL_THROTTLE,	-500, 500, -500, 500 },
	{ INPUT_RULE_IMIN, WEIGHT_STAB_ROLL_RATE,	100, 0, 0, 0 },
	{ INPUT_RULE_IMIN, WEIGHT_STAB_PITCH_RATE,	100, 0, 0, 0 },
	{ INPUT_RULE_IMIN, WEIGHT_STAB_YAW_RATE,	100, 0, 0, 0 },
};

const struct controller_rule_def angleControl[] = {
	{ INPUT_COMMAND_ROLL, CONTROL_ROLL_ANGLE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_PITCH, CONTROL_PITCH_ANGLE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_YAW, CONTROL_YAW_RATE,		-500, 500, -500, 500 },
	{ INPUT_COMMAND_THROTTLE, CONTROL_THROTTLE, -500, 500, -500, 500 },
	{ INPUT_RULE_IMIN, WEIGHT_STAB_ROLL_ANGLE,	100, 0, 0, 0 },
	{ INPUT_RULE_IMIN, WEIGHT_STAB_PITCH_ANGLE,	100, 0, 0, 0 },
	{ INPUT_RULE_IMIN, WEIGHT_STAB_YAW_RATE,	100, 0, 0, 0 },
}

const struct controller_rule_def horizonControl[] = {
	{ INPUT_COMMAND_ROLL, CONTROL_ROLL_RATE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_PITCH, CONTROL_PITCH_RATE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_ROLL, CONTROL_ROLL_ANGLE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_PITCH, CONTROL_PITCH_ANGLE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_YAW, CONTROL_YAW_RATE,		-500, 500, -500, 500 },
	{ INPUT_COMMAND_THROTTLE, CONTROL_THROTTLE, -500, 500, -500, 500 },
	{ INPUT_COMMAND_ROLL, WEIGHT_STAB_ROLL_RATE,-500, 0, 100, 0 },
	{ INPUT_COMMAND_ROLL, WEIGHT_STAB_ROLL_RATE, 0, 500, 0, 100 },
	{ INPUT_COMMAND_PITCH,WEIGHT_STAB_PITCH_RATE,-500, 0, 100, 0 },
	{ INPUT_COMMAND_PITCH,WEIGHT_STAB_PITCH_RATE,0, 500, 0, 100 },
	{ INPUT_RULE_IMIN, WEIGHT_STAB_YAW_RATE,	100, 0, 0, 0 },
	{ INPUT_COMMAND_ROLL, WEIGHT_STAB_ROLL_ANGLE, -500, 0, 0, 100 },
	{ INPUT_COMMAND_ROLL, WEIGHT_STAB_ROLL_ANGLE, 0, 500, 100, 0 },
	{ INPUT_COMMAND_PITCH,WEIGHT_STAB_PITCH_ANGLE, -500, 0, 0, 100 },
	{ INPUT_COMMAND_PITCH,WEIGHT_STAB_PITCH_ANGLE, 0, 500, 100, 0 },
}

const struct controller_rule_def raceControl[] = {
	{ INPUT_COMMAND_ROLL, CONTROL_ROLL_RATE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_PITCH, CONTROL_PITCH_RATE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_ROLL, CONTROL_ROLL_ANGLE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_PITCH, CONTROL_PITCH_ANGLE,	-500, 500, -450, 450 },
	{ INPUT_COMMAND_YAW, CONTROL_YAW_RATE,		-500, 500, -500, 500 },
	{ INPUT_COMMAND_THROTTLE, CONTROL_THROTTLE, -500, 500, -500, 500 },

	{ INPUT_COMMAND_ROLL, WEIGHT_STAB_ROLL_RATE,-500, 0, 100, 0 },
	{ INPUT_COMMAND_ROLL, WEIGHT_STAB_ROLL_RATE, 0, 500, 0, 100 },

	{ INPUT_COMMAND_PITCH,WEIGHT_STAB_PITCH_RATE,-500, 0, 100, 0 },
	{ INPUT_COMMAND_PITCH,WEIGHT_STAB_PITCH_RATE,0, 500, 0, 100 },

	{ INPUT_COMMAND_ROLL, WEIGHT_STAB_ROLL_ANGLE, -500, 0, 0, 100 },
	{ INPUT_COMMAND_ROLL, WEIGHT_STAB_ROLL_ANGLE, 0, 500, 100, 0 },

	{ INPUT_COMMAND_PITCH,WEIGHT_STAB_PITCH_ANGLE, -500, 0, 0, 100 },
	{ INPUT_COMMAND_PITCH,WEIGHT_STAB_PITCH_ANGLE, 0, 500, 100, 0 },

	{ INPUT_RULE_IMIN, WEIGHT_STAB_YAW_RATE,	100, 0, 0, 0 },
}

void _pid_compute(struct controller *self, uint8_t axis, int32_t desired, int32_t measured){
	const int32_t err = desired - measured;
	int32_t P = (err * self->config->P8[axis] * self->PIDweight[axis] / 100) >> 7;
}

void controller_update(struct controller *self){
	
}

